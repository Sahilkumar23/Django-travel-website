<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - WanderChronicles</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Poppins', sans-serif;
            padding: 20px;
        }
        .checkout-container {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 12px 35px rgba(34, 60, 80, 0.25);
            width: 500px;
            max-width: 90vw;
            padding: 40px 35px 35px 35px;
            position: relative;
            animation: fadeInUp 0.9s cubic-bezier(.39,.575,.565,1) both;
        }
        @keyframes fadeInUp{
            0%{transform:translateY(40px);opacity:0}
            100%{transform:translateY(0);opacity:1}
        }
        .checkout-header {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 14px 14px 0 0;
            padding: 28px 0 20px 0;
            text-align: center;
            margin: -40px -35px 25px -35px;
            box-shadow: 0 2px 10px #0002;
        }
        .checkout-header h2 {
            margin: 0;
            font-size: 2rem;
            letter-spacing: 1px;
        }
        .booking-details {
            margin-bottom: 30px;
        }
        .booking-list {
            list-style: none;
            padding: 0;
            margin: 0 0 12px 0;
        }
        .booking-list li {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #E0E8EF;
            font-size: 1.05rem;
        }
        .booking-list li:last-child {
            border-bottom: none;
        }
        .booking-amount {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, #f7971e 0%, #ffd200 100%);
            color: #222;
            border-radius: 8px;
            font-size: 1.15rem;
            font-weight: 600;
            padding: 14px 20px;
            margin-top: 14px;
            box-shadow: 0 2px 7px #ffd40047;
        }
        .select-group {
            margin-top: 30px;
        }
        .select-label {
            font-weight: 600;
            color: #234;
            display: block;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }
        .select-control {
            width: 100%;
            padding: 13px 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color .23s;
            background: #fafbfc;
            margin-bottom: 10px;
        }
        .select-control:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 2.5px #667eea80;
        }
        .confirm-btn {
            display: block;
            width: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            font-size: 1.2rem;
            font-weight: 700;
            padding: 16px;
            border-radius: 40px;
            margin-top: 18px;
            cursor: pointer;
            box-shadow: 0 6px 24px rgba(102, 126, 234, 0.3);
            letter-spacing: 1px;
            transition: .2s;
            text-decoration: none;
            text-align: center;
        }
        .confirm-btn:hover, .confirm-btn:focus {
            background: linear-gradient(90deg, #764ba2 0%, #667eea 100%);
            box-shadow: 0 8px 30px #667eea22;
            transform: translateY(-2px) scale(1.02);
        }
        .booking-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .booking-info p {
            margin: 5px 0;
            color: #555;
        }
        .booking-info strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="checkout-container">
        <div class="checkout-header">
            <h2><i class="fas fa-plane"></i> Confirm Your Booking</h2>
            <p style="font-size:1.05rem;letter-spacing:0.5px;margin-top:7px;">Review your trip details and complete payment</p>
        </div>
        
        <div id="bookingInfo" class="booking-info" style="display: none;">
            <p><strong>Name:</strong> <span id="bookingName"></span></p>
            <p><strong>Email:</strong> <span id="bookingEmail"></span></p>
            <p><strong>Phone:</strong> <span id="bookingPhone"></span></p>
            <p><strong>Destination:</strong> <span id="bookingDestination"></span></p>
            <p><strong>Travel Dates:</strong> <span id="bookingDates"></span></p>
            <p><strong>Travelers:</strong> <span id="bookingTravelers"></span></p>
        </div>

        <div id="bookingForm" class="booking-info" style="display: none;">
            <h3 style="margin-top: 0; margin-bottom: 15px; color: #333;">Enter Your Details</h3>
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Full Name *</label>
                <input type="text" id="inputName" class="select-control" placeholder="Enter your full name" required>
            </div>
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Email Address *</label>
                <input type="email" id="inputEmail" class="select-control" placeholder="your.email@example.com" required>
            </div>
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Phone Number *</label>
                <input type="tel" id="inputPhone" class="select-control" placeholder="+91 1234567890" required>
            </div>
            <button type="button" id="saveDetailsBtn" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: 600; margin-top: 10px;">Save Details</button>
        </div>

        <div class="booking-details">
            <ul class="booking-list" id="bookingList">
                <li><span>Destination Package</span><span id="packagePrice">₹0</span></li>
                <li><span>Service Fee</span><span>₹500</span></li>
                <li><span>Taxes & Charges</span><span id="taxes">₹0</span></li>
            </ul>
            <div class="booking-amount">
                <span>Total Amount</span>
                <span id="totalAmount">₹0</span>
            </div>
        </div>
        <form>
            <div class="select-group">
                <label class="select-label" for="paymentMethod">Select Payment Method</label>
                <select class="select-control" id="paymentMethod" required>
                    <option value="">Choose a payment option</option>
                    <option value="upi">UPI</option>
                    <option value="ecash">E-Cash Wallet</option>
                    <option value="card">Credit/Debit Card</option>
                    <option value="netbanking">Net Banking</option>
                </select>
            </div>
            <a href="{% url 'plan_trip' %}" class="confirm-btn" id="confirmBtn">Plan & Confirm</a>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get booking data from sessionStorage
            const tripData = JSON.parse(sessionStorage.getItem('tripData') || '{}');
            const destinationData = JSON.parse(sessionStorage.getItem('destinationData') || '{}');
            
            // If destination data exists (from Book Now button), use it
            if (destinationData.destination) {
                const price = destinationData.price || 0;
                const serviceFee = 500;
                const taxes = Math.round(price * 0.18); // 18% GST
                const total = price + serviceFee + taxes;
                
                document.getElementById('packagePrice').textContent = '₹' + price.toLocaleString('en-IN');
                document.getElementById('taxes').textContent = '₹' + taxes.toLocaleString('en-IN');
                document.getElementById('totalAmount').textContent = '₹' + total.toLocaleString('en-IN');
                
                // If user details are missing, show form
                if (!destinationData.name || !destinationData.email || !destinationData.phone) {
                    document.getElementById('bookingForm').style.display = 'block';
                    // Show destination info in a separate section
                    const formDiv = document.getElementById('bookingForm');
                    const destInfo = document.createElement('div');
                    destInfo.style.cssText = 'background: #e3f2fd; padding: 10px; border-radius: 8px; margin-bottom: 15px;';
                    destInfo.innerHTML = `
                        <p style="margin: 5px 0;"><strong>Destination:</strong> ${destinationData.destination || 'Not specified'}</p>
                        <p style="margin: 5px 0;"><strong>Travel Dates:</strong> ${destinationData.dates || 'To be selected'}</p>
                        <p style="margin: 5px 0;"><strong>Travelers:</strong> ${destinationData.travelers || '1'}</p>
                    `;
                    formDiv.insertBefore(destInfo, formDiv.firstChild.nextSibling);
                    
                    // Save details button
                    document.getElementById('saveDetailsBtn').addEventListener('click', function() {
                        const name = document.getElementById('inputName').value;
                        const email = document.getElementById('inputEmail').value;
                        const phone = document.getElementById('inputPhone').value;
                        
                        if (name && email && phone) {
                            destinationData.name = name;
                            destinationData.email = email;
                            destinationData.phone = phone;
                            sessionStorage.setItem('destinationData', JSON.stringify(destinationData));
                            
                            // Update display
                            document.getElementById('bookingName').textContent = name;
                            document.getElementById('bookingEmail').textContent = email;
                            document.getElementById('bookingPhone').textContent = phone;
                            
                            document.getElementById('bookingForm').style.display = 'none';
                            document.getElementById('bookingInfo').style.display = 'block';
                        } else {
                            alert('Please fill in all required fields');
                        }
                    });
                } else {
                    // Show booking info if all details are present
                    document.getElementById('bookingName').textContent = destinationData.name;
                    document.getElementById('bookingEmail').textContent = destinationData.email;
                    document.getElementById('bookingPhone').textContent = destinationData.phone;
                    document.getElementById('bookingDestination').textContent = destinationData.destination;
                    document.getElementById('bookingDates').textContent = destinationData.dates || 'To be selected';
                    document.getElementById('bookingTravelers').textContent = destinationData.travelers || '1';
                    document.getElementById('bookingInfo').style.display = 'block';
                }
            } 
            // If trip data exists (from Plan Trip page), use it
            else if (tripData.fullName) {
                document.getElementById('bookingName').textContent = tripData.fullName || 'Not provided';
                document.getElementById('bookingEmail').textContent = tripData.email || 'Not provided';
                document.getElementById('bookingPhone').textContent = tripData.phone || 'Not provided';
                
                const destText = tripData.destination ? tripData.destination.charAt(0).toUpperCase() + tripData.destination.slice(1) : 'Not specified';
                document.getElementById('bookingDestination').textContent = destText;
                
                const dates = tripData.departDate ? 
                    (tripData.returnDate ? `${tripData.departDate} to ${tripData.returnDate}` : tripData.departDate) : 
                    'Not specified';
                document.getElementById('bookingDates').textContent = dates;
                
                const travelers = `${tripData.adults || 1} Adult(s)${tripData.children > 0 ? ', ' + tripData.children + ' Child(ren)' : ''}`;
                document.getElementById('bookingTravelers').textContent = travelers;
                
                const budget = parseInt(tripData.budget) || 0;
                const serviceFee = 500;
                const taxes = Math.round(budget * 0.18);
                const total = budget + serviceFee + taxes;
                
                document.getElementById('packagePrice').textContent = '₹' + budget.toLocaleString('en-IN');
                document.getElementById('taxes').textContent = '₹' + taxes.toLocaleString('en-IN');
                document.getElementById('totalAmount').textContent = '₹' + total.toLocaleString('en-IN');
                
                document.getElementById('bookingInfo').style.display = 'block';
            }
            // Default values if no data
            else {
                document.getElementById('packagePrice').textContent = '₹0';
                document.getElementById('taxes').textContent = '₹0';
                document.getElementById('totalAmount').textContent = '₹500';
            }
            
            // Handle form submission
            document.getElementById('confirmBtn').addEventListener('click', function(e) {
                const paymentMethod = document.getElementById('paymentMethod').value;
                if (!paymentMethod) {
                    e.preventDefault();
                    alert('Please select a payment method');
                    return false;
                }
                // Store payment method
                sessionStorage.setItem('paymentMethod', paymentMethod);
            });
        });
    </script>
</body>
</html>
